import{e as G,u as V,c as j,a as z}from"./Bn2h5X3h.js";import{s as E,k as g,X as q,e as F,cc as Y,z as C,v as H,aq as W,bu as X,$ as J,j as O,o as B,w as h,b as P,i as c,q as _,a5 as Q,W as Z,S as ee}from"./BiiBGYRd.js";import{S as R,P as N}from"./DkPbciIt.js";import{u as te}from"./Cc81KTfG.js";function M(){let e=document.activeElement;if(e==null)return null;for(;e!=null&&e.shadowRoot!=null&&e.shadowRoot.activeElement!=null;)e=e.shadowRoot.activeElement;return e}function x(){const e=E(),s=g(()=>{var o,a;return["#text","#comment"].includes((o=e.value)==null?void 0:o.$el.nodeName)?(a=e.value)==null?void 0:a.$el.nextElementSibling:G(e)});return{primitiveElement:e,currentElement:s}}const K="data-reka-collection-item";function $(e={}){const{key:s="",isProvider:o=!1}=e,a=`${s}CollectionProvider`;let l;if(o){const r=E(new Map);l={collectionRef:E(),itemMap:r},W(a,l)}else l=q(a);const S=(r=!1)=>{const n=l.collectionRef.value;if(!n)return[];const i=Array.from(n.querySelectorAll(`[${K}]`)),f=Array.from(l.itemMap.value.values()).sort((m,I)=>i.indexOf(m.ref)-i.indexOf(I.ref));return r?f:f.filter(m=>m.ref.dataset.disabled!=="")},v=F({name:"CollectionSlot",setup(r,{slots:n}){const{primitiveElement:i,currentElement:d}=x();return H(d,()=>{l.collectionRef.value=d.value}),()=>C(R,{ref:i},n)}}),y=F({name:"CollectionItem",inheritAttrs:!1,props:{value:{validator:()=>!0}},setup(r,{slots:n,attrs:i}){const{primitiveElement:d,currentElement:f}=x();return Y(m=>{if(f.value){const I=X(f.value);l.itemMap.value.set(I,{ref:f.value,value:r.value}),m(()=>l.itemMap.value.delete(I))}}),()=>C(R,{...i,[K]:"",ref:d},n)}}),b=g(()=>Array.from(l.itemMap.value.values())),t=g(()=>l.itemMap.value.size);return{getItems:S,reactiveItems:b,itemMapSize:t,CollectionSlot:v,CollectionItem:y}}const oe="rovingFocusGroup.onEntryFocus",ne={bubbles:!1,cancelable:!0},ae={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function re(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function se(e,s,o){const a=re(e.key,o);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return ae[a]}function k(e,s=!1){const o=M();for(const a of e)if(a===o||(a.focus({preventScroll:s}),M()!==o))return}function le(e,s){return e.map((o,a)=>e[(s+a)%e.length])}const[ie,ue]=j("RovingFocusGroup"),pe=F({__name:"RovingFocusGroup",props:{orientation:{default:void 0},dir:{},loop:{type:Boolean,default:!1},currentTabStopId:{},defaultCurrentTabStopId:{},preventScrollOnEntryFocus:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["entryFocus","update:currentTabStopId"],setup(e,{expose:s,emit:o}){const a=e,l=o,{loop:S,orientation:v,dir:y}=J(a),b=te(y),t=V(a,"currentTabStopId",l,{defaultValue:a.defaultCurrentTabStopId,passive:a.currentTabStopId===void 0}),r=E(!1),n=E(!1),i=E(0),{getItems:d,CollectionSlot:f}=$({isProvider:!0});function m(u){const w=!n.value;if(u.currentTarget&&u.target===u.currentTarget&&w&&!r.value){const T=new CustomEvent(oe,ne);if(u.currentTarget.dispatchEvent(T),l("entryFocus",T),!T.defaultPrevented){const A=d().map(p=>p.ref).filter(p=>p.dataset.disabled!==""),D=A.find(p=>p.getAttribute("data-active")===""),U=A.find(p=>p.id===t.value),L=[D,U,...A].filter(Boolean);k(L,a.preventScrollOnEntryFocus)}}n.value=!1}function I(){setTimeout(()=>{n.value=!1},1)}return s({getItems:d}),ue({loop:S,dir:b,orientation:v,currentTabStopId:t,onItemFocus:u=>{t.value=u},onItemShiftTab:()=>{r.value=!0},onFocusableItemAdd:()=>{i.value++},onFocusableItemRemove:()=>{i.value--}}),(u,w)=>(B(),O(c(f),null,{default:h(()=>[P(c(N),{tabindex:r.value||i.value===0?-1:0,"data-orientation":c(v),as:u.as,"as-child":u.asChild,dir:c(b),style:{outline:"none"},onMousedown:w[0]||(w[0]=T=>n.value=!0),onMouseup:I,onFocus:m,onBlur:w[1]||(w[1]=T=>r.value=!1)},{default:h(()=>[_(u.$slots,"default")]),_:3},8,["tabindex","data-orientation","as","as-child","dir"])]),_:3}))}}),ve=F({__name:"RovingFocusItem",props:{tabStopId:{},focusable:{type:Boolean,default:!0},active:{type:Boolean},allowShiftKey:{type:Boolean},asChild:{type:Boolean},as:{default:"span"}},setup(e){const s=e,o=ie(),a=z(),l=g(()=>s.tabStopId||a),S=g(()=>o.currentTabStopId.value===l.value),{getItems:v,CollectionItem:y}=$();Q(()=>{s.focusable&&o.onFocusableItemAdd()}),Z(()=>{s.focusable&&o.onFocusableItemRemove()});function b(t){if(t.key==="Tab"&&t.shiftKey){o.onItemShiftTab();return}if(t.target!==t.currentTarget)return;const r=se(t,o.orientation.value,o.dir.value);if(r!==void 0){if(t.metaKey||t.ctrlKey||t.altKey||!s.allowShiftKey&&t.shiftKey)return;t.preventDefault();let n=[...v().map(i=>i.ref).filter(i=>i.dataset.disabled!=="")];if(r==="last")n.reverse();else if(r==="prev"||r==="next"){r==="prev"&&n.reverse();const i=n.indexOf(t.currentTarget);n=o.loop.value?le(n,i+1):n.slice(i+1)}ee(()=>k(n))}}return(t,r)=>(B(),O(c(y),null,{default:h(()=>[P(c(N),{tabindex:S.value?0:-1,"data-orientation":c(o).orientation.value,"data-active":t.active?"":void 0,"data-disabled":t.focusable?void 0:"",as:t.as,"as-child":t.asChild,onMousedown:r[0]||(r[0]=n=>{t.focusable?c(o).onItemFocus(l.value):n.preventDefault()}),onFocus:r[1]||(r[1]=n=>c(o).onItemFocus(l.value)),onKeydown:b},{default:h(()=>[_(t.$slots,"default")]),_:3},8,["tabindex","data-orientation","data-active","data-disabled","as","as-child"])]),_:3}))}});export{ae as M,pe as _,ve as a,M as g,$ as u};
